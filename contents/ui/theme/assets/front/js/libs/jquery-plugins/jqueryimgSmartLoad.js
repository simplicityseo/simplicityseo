(function($,window){var pluginName='imgSmartLoad',defaults={load_all_images_on_first_scroll:false,attribute:['data-src','data-srcset','data-sizes'],excludeImg:[],threshold:200,fadeIn_options:{duration:400},delaySmartLoadEvent:0,},skipImgClass='tc-smart-load-skip';function Plugin(element,options){this.element=element;this.options=$.extend({},defaults,options);if(_.isArray(this.options.excludeImg)){this.options.excludeImg.push('.'+skipImgClass);}else{this.options.excludeImg=['.'+skipImgClass];}
this._defaults=defaults;this._name=pluginName;this.init();}
Plugin.prototype.init=function(){var self=this,$_imgs=$('img['+this.options.attribute[0]+']:not('+this.options.excludeImg.join()+')',this.element);this.increment=1;this.timer=0;$_imgs.addClass(skipImgClass).bind('load_img',{},function(){self._load_img(this);});$(window).scroll(function(_evt){self._better_scroll_event_handler($_imgs,_evt);});$(window).resize(_.debounce(function(_evt){self._maybe_trigger_load($_imgs,_evt);},100));this._maybe_trigger_load($_imgs);};Plugin.prototype._better_scroll_event_handler=function($_imgs,_evt){var self=this;if(!this.doingAnimation){this.doingAnimation=true;window.requestAnimationFrame(function(){self._maybe_trigger_load($_imgs,_evt);self.doingAnimation=false;});}};Plugin.prototype._maybe_trigger_load=function($_imgs,_evt){var self=this,_visible_list=$_imgs.filter(function(ind,_img){return self._is_visible(_img,_evt);});_visible_list.map(function(ind,_img){$(_img).trigger('load_img');});};Plugin.prototype._is_visible=function(_img,_evt){var $_img=$(_img),wt=$(window).scrollTop(),wb=wt+$(window).height(),it=$_img.offset().top,ib=it+$_img.height(),th=this.options.threshold;if(_evt&&'scroll'==_evt.type&&this.options.load_all_images_on_first_scroll)
return true;return ib>=wt-th&&it<=wb+th;};Plugin.prototype._load_img=function(_img){var $_img=$(_img),_src=$_img.attr(this.options.attribute[0]),_src_set=$_img.attr(this.options.attribute[1]),_sizes=$_img.attr(this.options.attribute[2]),self=this;$_img.parent().addClass('smart-loading');$_img.unbind('load_img').hide().removeAttr(this.options.attribute.join(' ')).attr('sizes',_sizes).attr('srcset',_src_set).attr('src',_src).load(function(){if(!$_img.hasClass('tc-smart-loaded')){$_img.fadeIn(self.options.fadeIn_options).addClass('tc-smart-loaded');}
if(('undefined'!==typeof $_img.attr('data-tcjp-recalc-dims'))&&(false!==$_img.attr('data-tcjp-recalc-dims'))){var _width=$_img.originalWidth(),_height=$_img.originalHeight();if(2!=_.size(_.filter([_width,_height],function(num){return _.isNumber(parseInt(num,10))&&num>1;})))
return;$_img.removeAttr('data-tcjp-recalc-dims scale');$_img.attr('width',_width);$_img.attr('height',_height);}
$_img.trigger('smartload');$_img.data('czr-smart-loaded',true);});if($_img[0].complete){$_img.load();}
$_img.parent().removeClass('smart-loading');};$.fn[pluginName]=function(options){return this.each(function(){if(!$.data(this,'plugin_'+pluginName)){$.data(this,'plugin_'+pluginName,new Plugin(this,options));}});};})(jQuery,window);