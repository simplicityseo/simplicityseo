(function($,window,_){var pluginName='czrParallax',defaults={parallaxRatio:0.5,parallaxDirection:1,parallaxOverflowHidden:true,oncustom:[],backgroundClass:'image',matchMedia:'only screen and (max-width: 768px)'};function Plugin(element,options){this.element=$(element);this.element_wrapper=this.element.closest('.parallax-wrapper');this.options=$.extend({},defaults,options,this.parseElementDataOptions());this._defaults=defaults;this._name=pluginName;this.init();}
Plugin.prototype.parseElementDataOptions=function(){return this.element.data();};Plugin.prototype.init=function(){this.$_document=$(document);this.$_window=czrapp?czrapp.$_window:$(window);this.doingAnimation=false;this.initWaypoints();this.stageParallaxElements();this._bind_evt();};Plugin.prototype._bind_evt=function(){_.bindAll(this,'maybeParallaxMe','parallaxMe');};Plugin.prototype.stageParallaxElements=function(){this.element.css({'position':this.element.hasClass(this.options.backgroundClass)?'absolute':'relative','will-change':'transform'});if(this.options.parallaxOverflowHidden){var $_wrapper=this.element_wrapper;if($_wrapper.length)
$_wrapper.css('overflow','hidden');}};Plugin.prototype.initWaypoints=function(){var self=this;this.way_start=new Waypoint({element:self.element_wrapper.length?self.element_wrapper:self.element,handler:function(){self.maybeParallaxMe();if(!self.element.hasClass('parallaxing')){self.$_window.on('scroll',self.maybeParallaxMe);self.element.addClass('parallaxing');}else{self.element.removeClass('parallaxing');self.$_window.off('scroll',self.maybeParallaxMe);self.doingAnimation=false;self.element.css('top',0);}}});this.way_stop=new Waypoint({element:self.element_wrapper.length?self.element_wrapper:self.element,handler:function(){self.maybeParallaxMe();if(!self.element.hasClass('parallaxing')){self.$_window.on('scroll',self.maybeParallaxMe);self.element.addClass('parallaxing');}else{self.element.removeClass('parallaxing');self.$_window.off('scroll',self.maybeParallaxMe);self.doingAnimation=false;}},offset:function(){return-this.adapter.outerHeight();}});};Plugin.prototype.maybeParallaxMe=function(){var self=this;if(_.isFunction(window.matchMedia)&&matchMedia(self.options.matchMedia).matches)
return this.setTopPosition();if(!this.doingAnimation){this.doingAnimation=true;window.requestAnimationFrame(function(){self.parallaxMe();self.doingAnimation=false;});}};Plugin.prototype.setTopPosition=function(_top_){_top_=_top_||0;this.element.css({'transform':'translate3d(0px, '+_top_+'px, .01px)','-webkit-transform':'translate3d(0px, '+_top_+'px, .01px)'});};Plugin.prototype.parallaxMe=function(){var ratio=this.options.parallaxRatio,parallaxDirection=this.options.parallaxDirection,value=ratio*parallaxDirection*(this.$_document.scrollTop()-this.way_start.triggerPoint);this.setTopPosition(parallaxDirection*value<0?0:value);};$.fn[pluginName]=function(options){return this.each(function(){if(!$.data(this,'plugin_'+pluginName)){$.data(this,'plugin_'+pluginName,new Plugin(this,options));}});};})(jQuery,window,_);