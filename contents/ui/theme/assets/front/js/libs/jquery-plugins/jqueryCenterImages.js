(function($,window){var pluginName='centerImages',defaults={enableCentering:true,onresize:true,onInit:true,oncustom:[],$containerToListen:null,imgSel:'img',defaultCSSVal:{width:'auto',height:'auto'},leftAdjust:0,zeroLeftAdjust:0,topAdjust:0,zeroTopAdjust:-2,enableGoldenRatio:false,goldenRatioLimitHeightTo:350,goldenRatioVal:1.618,skipGoldenRatioClasses:['no-gold-ratio'],disableGRUnder:767,useImgAttr:false,setOpacityWhenCentered:false,addCenteredClassWithDelay:0,opacity:1};function Plugin(element,options){var self=this;this.container=element;this.options=$.extend({},defaults,options);this._defaults=defaults;this._name=pluginName;this._customEvt=$.isArray(self.options.oncustom)?self.options.oncustom:self.options.oncustom.split(' ');this.init();}
Plugin.prototype.init=function(){var self=this,_do=function(_event_){_event_=_event_||'init';self._maybe_apply_golden_r();var $_imgs=$(self.options.imgSel,self.container);if(self.options.enableGoldenRatio){$(window).bind('resize',{},_.debounce(function(evt){self._maybe_apply_golden_r(evt);},200));}
if(1<=$_imgs.length&&self.options.enableCentering){self._parse_imgs($_imgs,_event_);}};if(self.options.onInit){_do();}
if($.isArray(self._customEvt)){self._customEvt.map(function(evt){var $_containerToListen=(self.options.$containerToListen instanceof $&&1<self.options.$containerToListen.length)?self.options.$containerToListen:$(self.container);$_containerToListen.bind(evt,{},function(){_do(evt);});});}};Plugin.prototype._maybe_apply_golden_r=function(){if(!this.options.enableGoldenRatio||!this.options.goldenRatioVal||0===this.options.goldenRatioVal)
return;if(!this._is_selector_allowed())
return;if(!this._is_window_width_allowed()){$(this.container).attr('style','');return;}
var new_height=Math.round($(this.container).width()/this.options.goldenRatioVal);new_height=new_height>this.options.goldenRatioLimitHeightTo?this.options.goldenRatioLimitHeightTo:new_height;$(this.container).css({'line-height':new_height+'px',height:new_height+'px'}).trigger('golden-ratio-applied');};Plugin.prototype._is_window_width_allowed=function(){return $(window).width()>this.options.disableGRUnder-15;};Plugin.prototype._parse_imgs=function($_imgs,_event_){var self=this;$_imgs.each(function(ind,img){var $_img=$(img);self._pre_img_cent($_img,_event_);if(self.options.onresize&&!$_img.data('resize-react-bound')){$_img.data('resize-react-bound',true);$(window).resize(_.debounce(function(){self._pre_img_cent($_img,'resize');},100));}});if($(self.container).attr('data-img-centered-in-container')){var _n=parseInt($(self.container).attr('data-img-centered-in-container'),10)+1;$(self.container).attr('data-img-centered-in-container',_n);}else{$(self.container).attr('data-img-centered-in-container',1);}};Plugin.prototype._pre_img_cent=function($_img){var _state=this._get_current_state($_img),self=this,_case=_state.current,_p=_state.prop[_case],_not_p=_state.prop['h'==_case?'v':'h'],_not_p_dir_val='h'==_case?(this.options.zeroTopAdjust||0):(this.options.zeroLeftAdjust||0);var _centerImg=function($_img){$_img.css(_p.dim.name,_p.dim.val).css(_not_p.dim.name,self.options.defaultCSSVal[_not_p.dim.name]||'auto').css(_p.dir.name,_p.dir.val).css(_not_p.dir.name,_not_p_dir_val);if(0!==self.options.addCenteredClassWithDelay&&_.isNumber(self.options.addCenteredClassWithDelay)){_.delay(function(){$_img.addClass(_p._class).removeClass(_not_p._class);},self.options.addCenteredClassWithDelay);}else{$_img.addClass(_p._class).removeClass(_not_p._class);}
if($_img.attr('data-img-centered')){var _n=parseInt($_img.attr('data-img-centered'),10)+1;$_img.attr('data-img-centered',_n);}else{$_img.attr('data-img-centered',1);}
return $_img;};if(this.options.setOpacityWhenCentered){$.when(_centerImg($_img)).done(function($_img){$_img.css('opacity',self.options.opacity);});}else{_.delay(function(){_centerImg($_img);},0);}};Plugin.prototype._get_current_state=function($_img){var c_x=$_img.closest(this.container).outerWidth(),c_y=$(this.container).outerHeight(),i_x=this._get_img_dim($_img,'x'),i_y=this._get_img_dim($_img,'y'),up_i_x=i_y*c_y!==0?Math.round(i_x/i_y*c_y):c_x,up_i_y=i_x*c_x!==0?Math.round(i_y/i_x*c_x):c_y,current='h';if(0!==c_x*i_x){current=(c_y/c_x)>=(i_y/i_x)?'h':'v';}
var prop={h:{dim:{name:'height',val:c_y},dir:{name:'left',val:(c_x-up_i_x)/2+(this.options.leftAdjust||0)},_class:'h-centered'},v:{dim:{name:'width',val:c_x},dir:{name:'top',val:(c_y-up_i_y)/2+(this.options.topAdjust||0)},_class:'v-centered'}};return{current:current,prop:prop};};Plugin.prototype._get_img_dim=function($_img,_dim){if(!this.options.useImgAttr)
return 'x'==_dim?$_img.outerWidth():$_img.outerHeight();if($_img.is(":visible")){return 'x'==_dim?$_img.outerWidth():$_img.outerHeight();}else{if('x'==_dim){var _width=$_img.originalWidth();return typeof _width===undefined?0:_width;}
if('y'==_dim){var _height=$_img.originalHeight();return typeof _height===undefined?0:_height;}}};Plugin.prototype._is_selector_allowed=function(){if(!$(this.container).attr('class'))
return true;if(!this.options.skipGoldenRatioClasses||!$.isArray(this.options.skipGoldenRatioClasses))
return true;var _elSels=$(this.container).attr('class').split(' '),_selsToSkip=this.options.skipGoldenRatioClasses,_filtered=_elSels.filter(function(classe){return-1!=$.inArray(classe,_selsToSkip);});return 0===_filtered.length;};$.fn[pluginName]=function(options){return this.each(function(){if(!$.data(this,'plugin_'+pluginName)){$.data(this,'plugin_'+pluginName,new Plugin(this,options));}});};})(jQuery,window);